<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:dbo="http://dbpedia.org/ontology/"
    xmlns:dbp="http://dbpedia.org/ontology/"
    xmlns:dbr="http://dbpedia.org/resource/" 
    xmlns:prov="http://www.w3.org/ns/prov#"
    xmlns:xml="http://www.w3.org/XML/1998/namespace"
    xmlns:foaf="http://xmlns.com/foaf/0.1/">
<head>
    <title>Node Tweets | Home</title>
    <!-- Custom Theme files -->
    <link rel="stylesheet" type="text/css" href="/semantic/dist/semantic.min.css">
    <link rel="stylesheet" href="node_modules/normalize.css/normalize.css">
    <link  rel="stylesheet" type="text/css" href="/CSS/main.css" media="all"/>
    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    <script src="/semantic/dist/semantic.min.js" type="text/javascript"></script>
    <!-- Custom Theme files -->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content=" Twitter API web Scrapper, Search form, Tweeter Tweets,  Google Maps API " />
    <!-- Lodash and Google Maps Packages -->
    <script src="https://cdn.jsdelivr.net/lodash/4.6.1/lodash.min.js" type="text/javascript"></script>
    <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyB0mU4ILaXvry-r7nQ3xnziVmCM_AkbCYM"></script>

</head>

<body>
<!--search start here-->

<!-- Header -->
<div class="ui container">
    <div class="ui blue message">
   <h4 class="cen">Querying the social Web!</h4>
    </div>
    <div class="ui info message">
        <i class="close icon"></i>
        <div class="header">
            <h4 class="ui">Team <b>NodeArtizts</b> welcomes you!.</h4>
        </div>
        <p>Track discussions concerning a football team and it's players!</p>
    </div>
<!-- Header End -->


<!-- Search Form -->
    <form class="ui form" id="myForm" onsubmit="return false;" name="myForm">
        <div class="ui segment">
        <!-- Search type selection -->
        <div class="fields">
            <div class=" centered fourteen wide field">
                <label>SEARCH TYPE</label>
                <select class="ui dropdown" name="Or">
                    <option value="">ALL</option>
                    <option value="No"> AND</option>
                    <option value="YES">OR</option>
                </select>
            </div>
        </div>
        <!-- Search Type Selection End  -->
        <!-- Form Fields -->
        <div class="fields">
            <div class=" twelve wide field">
                <label>Team Name:</label>
                    <input type="text" name="teamName" name="tm_name" placeholder="What @Team would you like to search for?">
            </div>
        </div>

        <div class="ui horizontal segments">
            <div class="ui segment">
                <div class="two wide field">
                    <div class="inline field">
                        <div class="ui slider checkbox">
                            <input type="checkbox" tabindex="0" class="hidden" name="TeamAut" value="YES">
                            <label>Author</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="ui segment">
                <div class="two wide field">
                    <div class="inline field">
                        <div class="ui slider checkbox">
                            <input type="checkbox" tabindex="0" class="hidden" name="TeamMen" value="YES">
                            <label>Mentions</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="fields">
            <div class=" twelve wide field">
                <label>Player Name:</label>
                <input type="text" name="playerName" placeholder="What @player name would you like to search for?">
            </div>
        </div>

        <div class="ui horizontal segments">
            <div class="ui segment">
                <div class="two wide field">
                    <div class="inline field">
                        <div class="ui slider checkbox">
                            <input type="checkbox" tabindex="0" class="hidden" name="PlayerAut" value="YES">
                            <label>Author</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="ui segment">
                <div class="two wide field">
                     <div class="inline field">
                            <div class="ui slider checkbox">
                                <input type="checkbox" tabindex="0" class="hidden" name="PlayerMen" value="YES">
                                <label>Mentions</label>
                            </div>
                     </div>
                 </div>
            </div>
        </div>
        <div class="ui equal width form">
            <div class="fields">
                <div class="field">
                    <label>Hashtags:</label>
                    <input type="text" name="hashtag" placeholder="Enter any related hashtags..">
                </div>
                <div class="field">
                    <label>Keywords:</label>
                    <input type="text" name="keywords" placeholder="" >
                </div>
            </div>
            <!-- Form Fields End -->
            <!-- Submit Button -->
        <button id="sendButton" tabindex="0">Search Twitter</button>
        <!-- Error/ Validation Massages -->
        <div class="ui error message">
            <ul class="list"></ul>
        </div>
        <!--  Error/ Validation Messages -->
        </div>
        </div>
    </form>
    <!--search ends here-->
    <form class="ui form" id="rdfPlayerForm" onsubmit="return false;" name="rdfForm">
       <div class="ui equal width form">
            <div class="fields">
                <div class="field">
                    <label>Date:</label>
                    <input type="text" name="Date" placeholder="12.5.2016">
                </div>
                <div class="field">
                    <label>Team 1:</label>
                    <input type="text" name="Team1" placeholder="Manchester United F.C." >
                </div>
                <div class="field">
                    <label>Team 2:</label>
                    <input type="text" name="Team2" placeholder="Arsenal F.C." >
                </div><br><br>
                <button class="ui primary large button" id="sendTeamRDFButton" tabindex="1">Send Data</button> <br><br>
                <!-- <div class="field">
                    <label>Player:</label>
                        <input type="text" name="Player" value="" placeholder="Wayne Rooney" /></div>
                <button class="ui primary large button" id="sendPlayerRDFButton" tabindex="2">Send Data</button> -->
            </div> 
            </div>
    </form>
<!-- UI Messages -->
     <div class="ui message">
        <div class="header">
            Change Log - Query Infomation
        </div>
        <ul class="list">
            <li>You can now see the most active users.</li>
            <li>You can now see the most active users and the words associated with them.</li>
            <li>You can now see the tweets. </li>
            <li>Profile images have also been added. </li>
            <li>Cache has been implemented with MongoDB.</li>
            <li>Geo-location tweets are available</li>
        </ul>
        <div class="ui info message" id="db_info">
            <i class="small close icon"></i>
        </div>
    </div>

<div class="ui segment">
        <div class="content">
          <div id="map-canvas" style="width:auto;%;height:300pt;align:center;"></div>
          <div id="flickr_photos"></div>
        </div>
</div>
<div class="ui horizontal divider"> <i class="huge loading map icon"></i></div>
<div class="ui three column divided grid" id="content">
    <div class="row">
        <div class=" five wide column">
            <div class="ui segment">
                <div id="count_result"></div>
            </div>
        </div>
        <div class="eight wide column">
            <div class="ui segment">
                <div id="result" class="ui relaxed  devided list"></div>
            </div>
        </div>
        <div class=" three wide column">
            <div class="ui stacked segment">
                <div id="counts"></div>
            </div>
            <div class="ui stacked segment">
                <div id="words"></div>
            </div>
        </div>
    </div>
    
</div>
    <a href="#0" class="cd-top">Top</a>
</div>
 <!-- Team RDF Form -->
<!-- <div>
    <form id="rdfTeamForm" onsubmit="return false;">
        Date:<br>
        <input type="text" name="Date" value="" placeholder="12.5.2016">
        <br>
        Team 1:<br>
        <input type="text" name="Team1" value="" placeholder="Manchester United F.C.">
        <br>
        Team 2:<br>
        <input type="text" name="Team2" value="" placeholder="Arsenal F.C.">
        <br><br>
        <button id="sendTeamRDFButton">Send Data</button>
    </form>
</div> -->
<!-- Player RDF Form -->
<div>
    <form id="rdfPlayerForm" onsubmit="return false;">
        Player:<br>
        <input type="text" name="Player" value="" placeholder="Wayne Rooney" />
        <br><br>
        <button id="sendPlayerRDFButton">Send Data</button>
    </form>
</div> 
<!-- RDF Return content -->
<div id="dbpContent">
    
</div>

    <script>
        function sendAjaxQuery(url, data) {
            $('#result').html('');
            var $bodyAndHtml = $("body,html");
            /**
            * Method to scroll to content when query is made.
            * browser scrolls down to content section
            *
            * @method scrollToContent
            * @param {object} $bodyAndHtml
            */
            function scrollToContent () {
                $bodyAndHtml.animate({scrollTop: $(window).scrollTop() + 1000 });
            }

            $.ajax({
                type: 'POST',
                url: 'postFile.html',
                dataType: 'json',
                data: data,
                success: function (tweets) {
                scrollToContent();

                    // Map Variables.
                    var latCoordinates = [];
                    var longCoordinates = [];
                    var tweetHTMLArray = [];
                    var tweets_A = [];

                    // Word Counts and User Frequency Variables
                    var wordCounts = {};
                    var userCounts = {};
                    var mostUsedWords = [];
                    var mostActiveUsers= [];

                    // Words that are not counted as words. should therefore be ignored.
                    var flaggedWords =
                    [
                    'a', 'A', 'as','it','on','in', 'to', 'o', 't.co', 't', 'co','or','RT',
                    'https','so','for', 'the', 'and', 'this', 'of', 'i', 'I' ,'1','2','3','4',
                    '5','6','7','8','9','0'
                    ];
                    /**
                    * Gives information on the frequency of tweets returned from the database
                    *
                    * @param tweets[1].added - tweets added to the database from the API
                    * @param tweets[1].count -  strength of tweets returned
                    *
                    */
                     if (tweets[2]){
                        var imgsdiv = $('<div id="imgs">Photos: </div>');
                         console.log(tweets[2]);
                         _.each(tweets[2], function(o){
                             console.log(o)
                             imgsdiv.append('<div>' +'' +"<img src='" + o +"'>" + '<br>' + '</div>');
                            //  var imgs = $();
                         });
                         $('#flickr_photos').append(imgsdiv);
                         
                    }

                    if(tweets[1].count){
                        var counts_db = '<div>' +
                                        '<br>' + 'Results Returned by the  Twitter API: ' +
                                        tweets[1].added + '&nbsp;' +'Tweets' + '<br>' +
                                        'New tweets stored into the database: ' + tweets[1].added +
                                        '<br>'+'Results returned by the database: ' +
                                         tweets[1].count+ ' ' + ' Tweets' +'<br>' +
                                        '</div>';
                        // tweets information sent to the web page
                        $('#db_info').append(counts_db);
                    } else {
                        $('#db_info').append(' Results Returned by the  Twitter API: ' +
                            "  " + tweets[1].added);
                    }
                    /**
                        * ForEach Loop - Loops through the tweet object to get the tweets and authors,
                        * Base loop where word and user frequency computation is done.
                        *
                        * @method methodName
                        * @param {date} date = dateReadable.toDateString();
                        * @param {tweetHtml} :
                        tweet.user.profile_image_url : The tweet users avatar,
                        tweet.user.name: The Authors name,
                        tweet.user.screen_name: The Authors screen name,
                        tweet.htmlContent: The tweet text,
                        tweet.retweeted_status.user.screen_name: The retweeted author.
                        *
                    */
                    var timeline = '<div class="ui blue cen header">' + '<h4>' + 'Tweets Timeline' +                          '</h4>' +  '<div class="ui horizontal divider">'+ '-' +
                        '</div>' + "</div>"
                    $('#result').append(timeline);

                    // Tweet object ForEach Loop with lodash.
                    _.each(tweets[0],function(tweet) {

                        //for word frequencies -
                        // clearing out twitter handles, links and hashtags
                        // pushing the cleared result to an array tweets_A.
                        if(tweet.text)  {
                            var initial_words = tweet.text.replace(/[^a-zA-Z0-9 ]/g, "");
                            var words_parse = initial_words.replace(/httpstc|RT/gi, "");
                            var words = words_parse.split(' ');
                            tweets_A.push(tweet.text);

                        // for most active users -
                        // getting twitter handles and frequencies.
                        var user_pattern = (/\B@[a-z0-9_-]+/gi);
                        var user_mentions= tweet.text.match(user_pattern);
                        _.each(user_mentions,function(users){
                            if (typeof userCounts[users] === 'undefined') {
                                userCounts[users] = 1;
                            } else {
                                userCounts[users]++
                            }
                        }); //users each

                        // Pushing tweets to the browser.
                        var dateReadable, date;
                        dateReadable = new Date(Date.parse(tweet.created_at));
                        date = dateReadable.toDateString();
                        var tweetHtml = '<div class="item">' +
                                        "<img class='ui avatar image'  src='" + tweet.user.profile_image_url + " '>" +
                                        '<div class="content">' + '<div class="header">' + "Author: " + tweet.user.name + '&nbsp;' +"<a title='"+ tweet.user.screen_name+"' href='http://twitter.com/" + tweet.user.screen_name+"'>" +'@'+ tweet.user.screen_name+ "</a>"+
                                            '&nbsp;'+ '\t\t' + '&nbsp;' + '</div>' + '<span class="date cen">' + ' Date: ' + date +  '</span>' + '<br>'+ '<br>'  + '<div class="description">' + "  Tweet: " + tweet.htmlContent + (tweet.retweeted_status ? "<br>  Retweet: " +'@'+
                                                    tweet.retweeted_status.user.screen_name : "") +'<div class="ui divider">'+ '</div>' + '</div>';
                        $('#result').append(tweetHtml); // sends the tweet object to the browser
                        $('#most_frequent_words').remove();

                        // Google Maps Implementation
                        // getting coordinates.
                        tweetHTMLArray.push(tweetHtml);
                        if (tweet.geo != null ) {
                            var tweet_lat = tweet.geo.coordinates[0];
                            var tweet_long = tweet.geo.coordinates[1];
                            longCoordinates.push(tweet_long);
                            latCoordinates.push(tweet_lat);
                        }

                        // ForEach Loop for getting word counts
                        _.each(words, function (word) {

                            if (flaggedWords.indexOf(word) === -1 && word != '') {
                                if (typeof wordCounts[word] === 'undefined') {
                                    wordCounts[word] = 1;
                                } else {
                                    wordCounts[word]++
                                }
                            }

                        }); // words each
                    }

                    }); //Tweet Each

                    // pushing the words and frequency to MostUsedWords
                    for( var word in wordCounts){
                        mostUsedWords.push({word: word, count: wordCounts[word]});
                    }
                    // pushing the users and frequency to MostActive Users
                    for (var user in userCounts){
                        mostActiveUsers.push({user: user, seen: userCounts[user]})
                    }

                    // Sorting MostActiveUsers based on Counts -[seen]
                    mostActiveUsers.sort(function(a, b) { return b.seen - a.seen;});
                    // Appending MostActiveUsers based on Counts to the browser
                    $('#counts').html('');
                    $('#counts').append("<div id='head_words' class='ui blue cen header'>" + "<h4>" + 'Most Active Users: ' + '</h4>' +  '<div class="ui horizontal divider">'+ '-' + '</div>' + "</div>");
                    for(var i= 0; i< 10; i++){
                        if (mostActiveUsers[i]){
                            $('#counts').append('<div id="most_active_users" class="">' +
                                    "<a title='" + mostActiveUsers[i].user + "' href='http://twitter.com/" +
                                    mostActiveUsers[i].user + "'>" + mostActiveUsers[i].user + '&nbsp;' +
                                    "</a>" +' (' + mostActiveUsers[i].seen + ')');
                        }
                    }

                    var finalArray = [];
                    // Sorting and Appending MostUsedWords based on counts to the browser
                    mostUsedWords.sort(function(a, b){ return b.count - a.count;});
                     $('#words').append("<div id='head_words' class='ui blue cen header'>" + "<h4>" + 'Most Frequent Words: ' + '</h4>' +  '<div class="ui horizontal divider">'+ '-' + '</div>' + "</div>");
                     for(var i= 0; i< 20; i++){
                         if (mostUsedWords[i]) {
                              // console.info(mostUsedWords[i]);
                              $('#words').append('<div id="most_frequent_words">' + ' ' + "&nbsp;&nbsp;&nbsp;" +
                                      mostUsedWords[i].word  + ':'+ '&nbsp;&nbsp;'+'(' + mostUsedWords[i].count + ") "
                                      + " </div>");
                         }
                     }

                    /**
                    * Function to get the Most Active Users and moost used words
                    * In relation to each other.
                    *
                    * @method activeUserAndKeywords
                    * @param {array} tweets_A  - An array of tweets
                    * @param {array} mostActiveUsers - An array of most active users
                    * @param {array} mostUsedWords - An array of the most used words
                    * @param {int}  tweet_counter - count of tweets associated with a user
                    * @param {int} word_counter - count of words associated with a user
                    * @return {Object} { User : info} where info is  {word : count}
                    */
                    function activeUserAndKeywords(tweets_A, mostActiveUsers, mostUsedWords){
                        var tweet_counter = 0;  //for counting the tweets user is found in
                        var word_counter = 0; //for counting the words in the tweets

                        _.each(mostActiveUsers, function (user) {
                        var temp_tweetCounter =0;
                        var activeUser = new RegExp(user.user);
                            var temp_info = {
                                author: {
                                    screen_name: user.user,
                                    temp_tweetSeen : user.seen,
                                    words : []
                                }
                            };

                            _.each(tweets_A, function(tweet) {
                                if (activeUser.test(tweet)) {
                                    tweet_counter++;
                                    temp_tweetCounter++;

                                    var temp_wordCount =0;
                                    _.each(mostUsedWords, function(word) {
                                        temp_wordCount++;
                                        if(temp_wordCount >=10)
                                            return;
                                        if (tweet.indexOf(word.word) >= 0){
                                            word_counter++;
                                            temp_info.author.words.push({word : word.word , count : word.count});
                                        } else{
                                            return word.word + " is NOT in tweet.";
                                        }
                                    });
                                } else {
                                    return user.user + " is NOT in tweet.";
                                }
                            });
                            temp_info.author.tweet_counts = temp_tweetCounter;
                            finalArray.push({ user : user.user,
                                data: temp_info});
                        });

                    }
                    activeUserAndKeywords(tweets_A, mostActiveUsers, mostUsedWords);

                    // appending activeUserAndKeywords results to the browser
                    $('#count_result').append("<div id='head_words' class='ui blue cen header'>" +
                        "<h4>" + 'Active Users and Words: ' + '</h4>' +
                        '<div class="ui horizontal divider">'+ '-' + '</div>' + "</div>" + '<br>');
                    for(var i= 0; i< 10; i++){
                        if (finalArray[i]) {
                            $('#count_result').append("<div>" + " <img class='ui avatar image'  src='https://twitter.com/" + finalArray[i].data.author.screen_name + "/profile_image?size=original'>" + '&nbsp;' + 'Author: ' + ' ' + "<a title='" + finalArray[i].data.author.screen_name +
                                "' href='http://twitter.com/" + finalArray[i].data.author.screen_name + "'>"
                                + finalArray[i].data.author.screen_name + "</a>" + '&nbsp;&nbsp;  ' +
                                '  ' + '  ' + 'Tweets: ' + finalArray[i].data.author.tweet_counts +
                                '&nbsp;' + "<div class='ui blue cen'>" + "<h5>" +
                                'Most Frequent Words:' + '</h5>' + '<div class="ui fitted divider">'
                                + '</div>' + "</div>");

                           var sortedArray =  _.sortBy(_.uniqBy(finalArray[i].data.author.words, 'word'), ['count', 'word']);
                            _.eachRight(_.take(sortedArray,10), function (word) {
                                $('#count_result').append('<div>' + word.word + '&nbsp;' + '  ' + '(' + word.count + ')'+" </div>");
                                 });
                            $('#count_result').append('<div class="ui divider"></div>');
                        }

                    }

                    /* Geo-location map */
                    function initialize() {
                        var mapCentre = new google.maps.LatLng(latCoordinates[0], longCoordinates[0]);
                        var mapOptions = {
                            zoom: 18,
                            center: mapCentre            };
                        var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
                        for (var i=0; i<longCoordinates.length; i++) {
                            var marker = new google.maps.Marker({
                                position: new google.maps.LatLng(latCoordinates[i], longCoordinates[i]),
                                map: map,
                                title: 'Tweet Marker'});
                            var infowindow = new google.maps.InfoWindow({
                                content: tweetHTMLArray[i]+latCoordinates[i]+', '+longCoordinates[i],
                                maxWidth:200});
                            infowindow.open(map,marker);
                            google.maps.event.addListener(marker, 'click', function() {
                                infowindow.open(map, marker);
                            });
                        }
                    }
                    if (latCoordinates.length > 0) {
                        initialize();
                    }
                    else {
                        $('.gm-style').remove();
                        $('#no_locations').remove();
                        $('#map-canvas').append("<div id='head_words' class='ui blue cen header'>" + "<h4 id='no_locations'>" + "<br>Your search returned no geo-located tweets :( try again next time :)" + "</h4>" +  '<div class="ui horizontal divider">'+ '-' + '</div>' + "</div>" + '<br>');

                    }

                },
                error: function(xhr, status, error) {
                    scrollToContent();
                    console.log('Error: ' + error.message);
                    $('#result').append('<li>' + 'Something went wrong sorry.' + '</li>'); // error output on web page
                    //alert('error connecting');
                }
            });

        }

        function sendTeamRDFAjaxQuery(url, data) {
        $.ajax({
            type: 'POST',
            url: 'rdfTeamData.html',
            dataType:'json',
            data: data,
            success: function (data) {
                var teamInfo = data;
                for (index in teamInfo) {
                     $('#dbpContent').append(displayInfo(teamInfo[index]));
                     // $('#dbpContent').append(playerInfo(teamInfo[index]));
                }
                
                
                function displayInfo(info) {
                    var manageruri = info[0].manager.value;
                    var managerRDF = manageruri.replace('http://dbpedia.org/resource/','');
                    var stadiumuri = info[0].stadium.value;
                    var stadiumRDF = stadiumuri.replace('http://dbpedia.org/resource/','');

                    var teamName = $('<div id="TeamRDFa" about="dbr:'+info[info.length-1].teamDBPName+'"></div>');
                        teamName.append('<a href="'+info[0].teamlink.value+'" class="'+info[0].teamlink.type+'"><h3 property="dbp:clubname" xml:lang="'+info[0].clubname["xml:lang"]+'" class="'+info[0].clubname.type+'">'+info[0].clubname.value+'</h3></a>') 
                        teamName.append('<p property="dbo:abstract" xml:lang="'+info[0].abstract["xml:lang"]+'" class="'+info[0].abstract.type+'" >Description: '+info[0].abstract.value+'</p>')
                        var players = $('<div property="dbp:name"></div>');
                            players.append('<p>Players: </p>')
                        for (index in info) {
                            if (index != (info.length-1)) {
                            players.append(playerInfo(info[index]));
                                                    }
                        }
                        teamName.append(players);
                        var managerDiv = $('<div property="dbo:manager"></div>');
                        var manager = $('<div about="dbr:'+managerRDF+'" class="'+info[0].manager.type+'"></div>');
                        manager.append('<p>Manager: </p>')
                        if (info[0].managerimg!= undefined) {
                                                manager.append('<img src="'+info[0].managerimg.value+'" property="dbo:thumbnail" rel="foaf:depiction" class="'+info[0].managerimg.type+'"/><br>')
                                                }

                         if (info[0].managerlink!= undefined && info[0].managername!= undefined) {
                            manager.append('<a href="'+info[0].managerlink.value+'" class="'+info[0].managerlink.type+'"><p property="dbp:fullname" class="'+info[0].managername.type+'" xml:lang="'+info[0].managername["xml:lang"]+'">'+info[0].managername.value+'</p></a>')
                         } else if(info[0].managername!= undefined){
                            manager.append('<p property="dbp:fullname" class="'+info[0].managername.type+'" xml:lang="'+info[0].managername["xml:lang"]+'">'+info[0].managername.value+'</p>')
                         }


                         managerDiv.append(manager);
                         teamName.append(managerDiv);
                        
                        var stadiumDiv = $('<div property="dbo:ground"></div>');
                        var stadium = $('<div about="'+stadiumRDF+'" class="'+info[0].stadium.type+'"></div>');

                        stadium.append('<p>Stadium: </p>')
                        stadium.append('<img src="'+info[0].stadiumimg.value+'" class="'+info[0].stadiumimg.type+'" property="dbo:thumbnail" rel="foaf:depiction"/><br>')
                        if(info[0].stadiumname != undefined) {
                         stadium.append('<a href="'+info[0].stadiumlink.value+'" class="'+info[0].stadiumlink.type+'" ><p property="dbp:name" class="'+info[0].stadiumname.type+'" xml:lang="'+info[0].stadiumname["xml:lang"]+'">'+info[0].stadiumname.value+'</p></a>')
                        }
                       
                        stadium.append('<p property="dbo:abstract" class="'+info[0].stadiumdscr.type+'" xml:lang="'+info[0].stadiumdscr["xml:lang"]+'">Description: '+info[0].stadiumdscr.value+'</p>');

                        stadiumDiv.append(stadium);
                        teamName.append(stadiumDiv);

                    return teamName;
                }

                function playerInfo(info) {
                    var playeruri = info.players.value;
                    var playerRDF = playeruri.replace('http://dbpedia.org/resource/','');


                    var playersTableDiv = $('<div about="dbr:'+playerRDF+'" class="'+info.players.type+'" rel="dbp:name"></div>');
                        if (info.playerimg != undefined) {
                        playersTableDiv.append('<img src="'+info.playerimg.value+'" property="dbo:thumbnail" rel="foaf:depiction"/>');
                        }
                        if (info.playername != undefined) {
                            playersTableDiv.append('<p property="dbp:fullname" xml:lang="'+info.playername["xml:lang"]+'" class="'+info.playername.type+'">Full Name: '+info.playername.value+'</p>')
                        }
                        if (info.playerdob != undefined) {
                        playersTableDiv.append('<p property="dbo:birthDate" datatype="'+info.playerdob.datatype+'" class="'+info.playerdob.type+'" >DOB: '+info.playerdob.value+'</p>');
                        }
                        if (info.playerpos != undefined) {
                            var str = info.playerpos.value;
                            var str2 = str.replace('http://dbpedia.org/resource/', '');
                            var pos = str2.replace(/_/g,' ');
                        playersPosDiv = $('<div about="dbr:'+str2+'"></div>') 
                        playersPosDiv.append('<p>Position: <a href="'+info.playerpos.value+'" property="dbo:position" class="'+info.playerpos.type+'">'+pos+'</a></p>')
                        playersTableDiv.append(playersPosDiv);
                        }
                        if (info.playerheight != undefined) {
                        playersTableDiv.append('<p property="dbo:height" class="'+info.playerheight.type+'">Height: '+info.playerheight.value+'m</p>')
                    }
                    return playersTableDiv;
                    // var playersTable = $('<table style="width:100%"></table');

                }
            },
            error: function (xhr, status, error) {
                console.log('Error: ' + error.message);
               alert('error connecting');
            }
        });
        
    }

        function sendPlayerRDFAjaxQuery(url, data) {
            $.ajax({
            type: 'POST',
            url: 'rdfPlayerData.html',
            dataType:'json',
            data: data,
            success: function (data) {
                var teamInfo = data;
                // for (index in teamInfo) {
                //      $('#dbpContent').append(displayInfo(teamInfo[index]));
                //      // $('#dbpContent').append(playerInfo(teamInfo[index]));
                // }
                
                
                // function displayInfo(info) {
                //     var manageruri = info[0].manager.value;
                //     var managerRDF = manageruri.replace('http://dbpedia.org/resource/','');
                //     var stadiumuri = info[0].stadium.value;
                //     var stadiumRDF = stadiumuri.replace('http://dbpedia.org/resource/','');

                //     var teamName = $('<div id="TeamRDFa" about="dbr:'+info[info.length-1].teamDBPName+'"></div>');
                //         teamName.append('<a href="'+info[0].teamlink.value+'" class="'+info[0].teamlink.type+'"><h3 property="dbp:clubname" xml:lang="'+info[0].clubname["xml:lang"]+'" class="'+info[0].clubname.type+'">'+info[0].clubname.value+'</h3></a>') 
                //         teamName.append('<p property="dbo:abstract" xml:lang="'+info[0].abstract["xml:lang"]+'" class="'+info[0].abstract.type+'" >Description: '+info[0].abstract.value+'</p>')
                //         var players = $('<div property="dbp:name"></div>');
                //             players.append('<p>Players: </p>')
                //         for (index in info) {
                //             if (index != (info.length-1)) {
                //             players.append(playerInfo(info[index]));
                //                                     }
                //         }
                //         teamName.append(players);
                //         var managerDiv = $('<div property="dbo:manager"></div>');
                //         var manager = $('<div about="dbr:'+managerRDF+'" class="'+info[0].manager.type+'"></div>');
                //         manager.append('<p>Manager: </p>')
                //         if (info[0].managerimg!= undefined) {
                //                                 manager.append('<img src="'+info[0].managerimg.value+'" property="dbo:thumbnail" rel="foaf:depiction" class="'+info[0].managerimg.type+'"/><br>')
                //                                 }

                //          if (info[0].managerlink!= undefined && info[0].managername!= undefined) {
                //             manager.append('<a href="'+info[0].managerlink.value+'" class="'+info[0].managerlink.type+'"><p property="dbp:fullname" class="'+info[0].managername.type+'" xml:lang="'+info[0].managername["xml:lang"]+'">'+info[0].managername.value+'</p></a>')
                //          } else if(info[0].managername!= undefined){
                //             manager.append('<p property="dbp:fullname" class="'+info[0].managername.type+'" xml:lang="'+info[0].managername["xml:lang"]+'">'+info[0].managername.value+'</p>')
                //          }


                //          managerDiv.append(manager);
                //          teamName.append(managerDiv);
                        
                //         var stadiumDiv = $('<div property="dbo:ground"></div>');
                //         var stadium = $('<div about="'+stadiumRDF+'" class="'+info[0].stadium.type+'"></div>');

                //         stadium.append('<p>Stadium: </p>')
                //         stadium.append('<img src="'+info[0].stadiumimg.value+'" class="'+info[0].stadiumimg.type+'" property="dbo:thumbnail" rel="foaf:depiction"/><br>')
                //         if(info[0].stadiumname != undefined) {
                //          stadium.append('<a href="'+info[0].stadiumlink.value+'" class="'+info[0].stadiumlink.type+'" ><p property="dbp:name" class="'+info[0].stadiumname.type+'" xml:lang="'+info[0].stadiumname["xml:lang"]+'">'+info[0].stadiumname.value+'</p></a>')
                //         }
                       
                //         stadium.append('<p property="dbo:abstract" class="'+info[0].stadiumdscr.type+'" xml:lang="'+info[0].stadiumdscr["xml:lang"]+'">Description: '+info[0].stadiumdscr.value+'</p>');

                //         stadiumDiv.append(stadium);
                //         teamName.append(stadiumDiv);

                //     return teamName;
                // }

                // function playerInfo(info) {
                //     var playeruri = info.players.value;
                //     var playerRDF = playeruri.replace('http://dbpedia.org/resource/','');


                //     var playersTableDiv = $('<div about="dbr:'+playerRDF+'" class="'+info.players.type+'" rel="dbp:name"></div>');
                //         if (info.playerimg != undefined) {
                //         playersTableDiv.append('<img src="'+info.playerimg.value+'" property="dbo:thumbnail" rel="foaf:depiction"/>');
                //         }
                //         if (info.playername != undefined) {
                //             playersTableDiv.append('<p property="dbp:fullname" xml:lang="'+info.playername["xml:lang"]+'" class="'+info.playername.type+'">Full Name: '+info.playername.value+'</p>')
                //         }
                //         if (info.playerdob != undefined) {
                //         playersTableDiv.append('<p property="dbo:birthDate" datatype="'+info.playerdob.datatype+'" class="'+info.playerdob.type+'" >DOB: '+info.playerdob.value+'</p>');
                //         }
                //         if (info.playerpos != undefined) {
                //             var str = info.playerpos.value;
                //             var str2 = str.replace('http://dbpedia.org/resource/', '');
                //             var pos = str2.replace(/_/g,' ');
                //         playersPosDiv = $('<div about="dbr:'+str2+'"></div>') 
                //         playersPosDiv.append('<p>Position: <a href="'+info.playerpos.value+'" property="dbo:position" class="'+info.playerpos.type+'">'+pos+'</a></p>')
                //         playersTableDiv.append(playersPosDiv);
                //         }
                //         if (info.playerheight != undefined) {
                //         playersTableDiv.append('<p property="dbo:height" class="'+info.playerheight.type+'">Height: '+info.playerheight.value+'m</p>')
                //     }
                //     return playersTableDiv;
                    // var playersTable = $('<table style="width:100%"></table');

                // }
            },
            error: function (xhr, status, error) {
                console.log('Error: ' + error.message);
               alert('error connecting');
            }
        });
        }
        $.fn.serializeObject = function() {
            var o = {};
            var a = this.serializeArray();
            $.each(a, function() {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        };
        // clearing initial web pages and sending query form to the server side.
        function sendData() {
            $('#most_active_users').html(''); $('#most_frequent_words').html('');
            $('#count_result').html(''); $('#db_info').html(''); $('#words').html('');
            var form = document.getElementById('myForm');
            sendAjaxQuery('http://localhost:3000/', JSON.stringify($('form').serializeObject()));
        }
        var sendButton = document.getElementById('sendButton');
        sendButton.onclick = sendData;

        function sendTeamRDFData() {
            var form = document.getElementById('rdfTeamForm');
            sendTeamRDFAjaxQuery('http://localhost:3000/', JSON.stringify($('form').serializeObject()));
        }

        var sendTeamRDFButton = document.getElementById('sendTeamRDFButton');
        sendTeamRDFButton.onclick = sendTeamRDFData;

        function sendPlayerRDFData() {
            var form = document.getElementById('rdfPlayerForm');
            sendPlayerRDFAjaxQuery('http://localhost:3000/', JSON.stringify($('form').serializeObject()));
        }

        var sendPlayerRDFButton = document.getElementById('sendPlayerRDFButton');
        sendPlayerRDFButton.onclick = sendPlayerRDFData;
    </script>
<footer>
    <div class="copyright">
            <p>2015 Leonrd & Hayford All rights reserved </p>
    </div>
</footer>
<script>
    // Form Validation with Jquery, Semantic UI and Regular expressions
    $('select.dropdown').dropdown();
    $('.ui.checkbox').checkbox();
    $('.ui.form').form({fields:
                        {
                        playerName: {
                        identifier : 'playerName',
                        optional   : true,
                        rules: [
                            {
                                type   : 'regExp[/@[a-z0-9_-]+/gi]',
                                prompt : 'Please enter a valid player  screen name.'
                            },
                            {
                                type   : 'empty',
                                prompt : 'Please enter a Player name.'
                            },
                            ]
                        },
                            teamName: {
                                identifier : 'teamName',
                                rules: [
                                    {
                                        type   : 'empty',
                                        prompt : 'Please enter a Team or Player name.'
                                    },
                                    {
                                        type   : 'regExp[/@[a-z0-9_-]+/gi]',
                                        prompt : 'Please enter a valid team screen name. - [@name]'
                                    }
                                ]
                            },
                            Hashtags: {
                                identifier : 'hashtag',
                                optional : true,
                                rules: [
                                    {
                                        type   : 'regExp[/#[a-z0-9_-]+/gi]',
                                        prompt : 'Please enter a valid Hashtag. - [#name]'
                                    }
                                ]
                            }

                }
    });
    $('.message .close')
            .on('click', function() {
                $(this).closest('.message').transition('fade');
            });
</script>
<script src="main.js"></script>
</div>
</body>
</html>