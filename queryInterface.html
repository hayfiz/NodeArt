<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>NodeArt</title>
  <link rel="stylesheet" type="text/css" href="/semantic/dist/semantic.min.css">
 <script src="/semantic/bower_components/jquery/dist/jquery.min.js"></script>
  <script src="/semantic/dist/semantic.min.js" type="text/javascript"></script>
</head>

<body>
  <div class="ui container">
    <h2 class="ui dividing header">Query some Twitter data</h2>
    <form class="ui form" id="myForm" onsubmit="return false;">
      <input type="radio" name="Or" value="No"> AND<br>
      <input type="radio" name="Or" value="YES"> OR<br>
      <div class="field">
        <label for="teamName"> Enter the @ of a team you would like to search for:</label>
        <input type="text" name="teamName" placeholder="@ManUtd">
        <div class="ui-checkbox">
        	<input type="checkbox" name="TeamAut" value="YES"></input>
        	<label> Author</label>
        </div>
        <div class="ui-checkbox">
        	<input type="checkbox" name="TeamMen" value="YES"></input>
        	<label> Mentions</label>
        </div>
      </div>
      <div class="field">
        <label for="playerName">Enter the @ of a player you'd like to find:</label>
        <input type="text" name="playerName" placeholder="@WayneRooney">
        <div class="ui-checkbox">
        	<input type="checkbox" name="PlayerAut" value="YES"></input>
        	<label> Author</label>
        </div>
        <div class="ui-checkbox">
        	<input type="checkbox" name="PlayerMen" value="YES"></input>
        	<label> Mentions</label>
        </div>
      </div>
      <div class="field">
        <label for="hashtag">Enter any related hashtags:</label>
        <input type="text" name="hashtag" placeholder="#Research">
      </div>
      <div class="field">
        <label for="keywords">Enter any specific keywords:</label>
        <input type="text" name="keywords" placeholder=" ">
      </div>
      <button class="ui button" id="sendButton">Query Data</button>
    </form>

    <ul id="result">
      <!-- for now lets make it simple -->
    </ul>
  </div>

  <script>
    function sendAjaxQuery(url, data) {
      $('#result').html('');
      $.ajax({
        type: 'POST',
        url: 'postFile.html',
        dataType: 'json',
        data: data,
        success: function(tweets) {
          //alert('success ' + data);
          //var struct = JSON.parse(data); //converting to object again
          for(var i = 0; i < tweets.length; i++){
            var tweet = tweets[i];
            var date = new Date(tweet.created_at);
            var tweetHtml = `
              <li>
                Author : ` + tweet.user.name  + ' @' + tweet.user.screen_name + ' Date:' + date.toISOString() +'<br> ' +
               `Tweet : `+ tweet.text
                Retweet :
                `</li>
            `;
          //  $('#result').append('<li>' + JSON.stringify(tweets[i]) + '</li>'); this bring out the tweet object as a whole
            $('#result').append(tweetHtml) // sends the tweet object to the browser

            delete tweets;
          }
        },
        error: function(xhr, status, error) {
          console.log('Error: ' + error.message);
          $('#result').append('<li>Something went wrong sorry.</li>'); // error output on webpage
          //alert('error connecting');
        }
      });
    }


    $.fn.serializeObject = function() {
      var o = {};
      var a = this.serializeArray();
      $.each(a, function() {
        if (o[this.name] !== undefined) {
          if (!o[this.name].push) {
            o[this.name] = [o[this.name]];
          }
          o[this.name].push(this.value || '');
        } else {
          o[this.name] = this.value || '';
        }
      });
      return o;
    };

    function sendData() {
      var form = document.getElementById('myForm');
      sendAjaxQuery('http://localhost:3000/', JSON.stringify($('form').serializeObject()));
    }


    var sendButton = document.getElementById('sendButton');
    sendButton.onclick = sendData;
  </script>
</body>

</html>
